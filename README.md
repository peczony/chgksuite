# chgksuite 0.1 #

**chgksuite** — это набор скриптов, облегчающих редактирование пакетов ЧГК.

## Функции ##

парсинг в формат микроразметки `.4s`:

- из *plain text* (`.txt`)
- из *Word 2007+* (`.docx`)

экспорт из `.4s` в:

  * в `.docx` для тестирования с возможностью автоматического забеления ответов, комментариев и источников;
  * в _LaTeX_ (`.tex`) для красивой вёрстки и печати / чтения с планшета;
  * в ЖЖ (преамбула — в теле поста, вопросы — в комментариях, по одному в каждом) с возможностью автоматического скрытия ответов, комментариев и источников за спойлерами.

## Пока не сделано ##

- поддержка нулевых вопросов
- экспорт в html
- импорт из html/xml (из Базы)
- streaming режим (поддержка pipe’ов)
- экспорт изображений в ЖЖ в форме base64 или автоматическая заливка на imgur

## Как установить ##

Вы можете скачать [последнюю версию репозитория](https://bitbucket.org/pecheny/chgksuite/get/tip.zip). Если у вас есть _Python_, вы можете воспользоваться `.py`-скриптами из архива, удовлетворив все зависимости через `pip install`. Если вы пользуетесь _Mercurial_, можете также клонировать репозиторий, скопировав ссылку из интерфейса _Bitbucket_.

Если у вас _Windows_ и нет _Python_, качайте дополнительно к репозиторию `.exe`-файлы [chgk_parser](https://dl.dropboxusercontent.com/u/24653887/chgk/chgk_parser.exe) и [chgk_composer](https://dl.dropboxusercontent.com/u/24653887/chgk/chgk_composer.exe). Остальное берите из архива по ссылке выше. Файлы с расширением `.py` можете удалить.

Для экспорта в _Word_ необходим файл `template.docx`, присутствующий в архиве. Для экспорта в _LaTeX_ необходимы `cheader.tex` и `fix-unnumbered-sections.sty`, также присутствующие в архиве, однако вы можете использовать собственную преамбулу, если пожелаете. Подробности экспорта в _LaTeX_ изложены в соответствующем разделе документации.

## Как пользоваться ##

Перед использованием положите входные файлы в папку, куда вы распаковали пакет `chgksuite` (или, напротив, скопируйте файлы `chgksuite` в папку, в которой собираетесь работать.

`chgk_parser (filename).(ext)` — парсит входной файл `(filename).(ext)` и создаёт `(filename).4s`. Тип файла (_Word_ или _plain text_) определяется по расширению, поэтому убедитесь, что ваши файлы имеют корректные расширения. Так, `chgk_parser.py paket.docx` создаст файл `paket.4s`.

`chgk_composer (filename).4s (output-filetype) (-l lj-user (-c community)) (--nospoilers|-n)` — создаёт из `.4s`-файла выходной файл указанного типа. Допустимые значение `(output-filetype)` — `docx`, `tex` и `lj`. В первых двух случаях будет создан выходной файл `(filename).docx` и `(filename).tex`, соответственно. При указании `lj` в качестве выходного формата также обязательно указать параметр `-l lj-user`, где `lj-user` — ваш логин в ЖЖ. После этого необходимо ввести пароль от вашего аккаунта в ЖЖ.

Если вы выкладываете пакет не в личный ЖЖ, а в сообщество, после `-l lj-user` введите `-c community`, где `community` — название сообщества (например, `ru_chgk`). Обратите внимание, что **выкладка в личный ЖЖ по умолчанию происходит «под глаз»**, так что итоговый пост виден только вам. Вы сможете посмотреть, всё ли выглядит так, как вы задумали, и после этого через форму редактирования поста на сайте ЖЖ изменить настройки видимости, чтобы его могли увидеть и другие пользователи. При выкладке в сообщество, однако, создатели ЖЖ не предусмотрели возможность выкладки «под глаз», так что **выкладка в сообщество публична**. Поэтому перед тем, как выложить пакет в сообщество, можно выложить пакет в личный ЖЖ под глаз, чтобы удостовериться, что пакет выглядит именно так, как вы задумывали.

Для режимов `docx` и `lj` по умолчанию включен режим «спойлеров», чтобы читатель не видел ответы и комментарии. Добавление `--nospoilers` к строке вызова программы позволяет вывести результат без спойлеров.

Также для всех режимов работает опция `--debug` для вывода отладочной информации. Если у вас что-то не работает или работает не так, как нужно, пришлите файлы, появившиеся после запуска с этой опцией, мне на `ap@pecheny.me` с описанием проблемы.

Примеры:

- `chgk_composer paket.4s docx` — создаст файл `paket.docx` с забелёнными ответами и комментариями.
- `chgk_composer paket.4s docx --nospoilers` — создаст файл `paket.docx` без забелённых ответов.
- `chgk_composer paket.4s tex` — создаст файл `paket.tex`, из которого впоследствии можно создать PDF, если у вас установлен LaTeX. Обратите внимание, что PDF-файлы предназначены для того, чтобы их читал ведущий на игре с распечатки или экрана планшета. Спойлеры в них не предусмотрены.
- `chgk_composer paket.4s lj -l pecheny` — выложит пакет со спойлерами в ЖЖ `pecheny`. Запись будет видна только пользователю `pecheny`.
- `chgk_composer paket.4s lj -l pecheny -c ru_chgk --nospoilers` — выложит пакет без спойлеров в сообщество `ru_chgk` от лица пользователя `pecheny`. Запись будет видна всем.

## Микроформат .4s ##

Микроформат _4s_ (название может поменяться) вдохновлён существующими микроформатами типа _Markdown_ и _reStructuredText_, однако отличается от них в силу специфики структуры пакетов ЧГК. Пакет в формате _4s_ состоит из последовательности элементов, принадлежащих к одному из типов. В начале строки записывается идентификатор типа элемента, а затем через любое количество пробелов — его значение. Строчка без идентификатора типа в начале считается продолжением предыдущего элемента (внутри элемента разрешены одинарные переносы строк). Существуют следующие типы элементов:

- `###`: заголовок.
- `#EDITOR`: редактор.
- `#DATE`: дата (отображающаяся в начале документа)
- `#`: любой метакомментарий, например, благодарности тестерам в преамбуле.
- `?`: текст вопроса.
- `!`: ответ.
- `=`: зачёт.
- `!=`: незачёт.
- `/`: комментарий.
- `^`: источник(и).
- `@`: автор(ы).

