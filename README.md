# chgksuite 0.1 #

**chgksuite** — это набор скриптов, облегчающих редактирование пакетов ЧГК.

## Функции ##

парсинг в формат микроразметки `.4s`:

- из *plain text* (`.txt`)
- из *Word 2007+* (`.docx`)

экспорт из `.4s`:

  * в `.docx` для тестирования с возможностью автоматического забеления ответов, комментариев и источников;
  * в _LaTeX_ (`.tex`) для красивой вёрстки и печати / чтения с планшета;
  * в ЖЖ (преамбула — в теле поста, вопросы — в комментариях, по одному в каждом) с возможностью автоматического скрытия ответов, комментариев и источников за спойлерами, а также автоматической загрузки изображений на хостинг imgur.
 * автоматическая расстановка «правильных» кавычек и тире, в _LaTeX_ также малых прописных (_small caps_).
 * поддержка нулевых вопросов и вопросов с произвольными идентификаторами

## Пока не сделано ##

- экспорт в html
- импорт из html/xml (из Базы)
- streaming режим (поддержка pipe’ов)

## Я не программист. Что мне делать? ##

Специально для вас есть [инструкция с картинками](https://bitbucket.org/pecheny/chgksuite/src/tip/nontechies.md?at=default). Читайте и пользуйтесь!

## Как установить ##

Вы можете скачать [последнюю версию репозитория](https://bitbucket.org/pecheny/chgksuite/get/tip.zip). Если у вас есть _Python_, вы можете воспользоваться `.py`-скриптами из архива, удовлетворив все зависимости через `pip install`. Если вы пользуетесь _Mercurial_, можете также клонировать репозиторий, скопировав ссылку из интерфейса _Bitbucket_.

Если у вас нет _Python_, качайте дополнительно к репозиторию бинарные файлы:

- Windows: [chgk_parser](https://dl.dropboxusercontent.com/u/24653887/chgk/chgk_parser.exe), [chgk_composer](https://dl.dropboxusercontent.com/u/24653887/chgk/chgk_composer.exe). 
- OS X: [chgk_parser](https://dl.dropboxusercontent.com/u/24653887/chgk/osx/chgk_parser), [chgk_composer](https://dl.dropboxusercontent.com/u/24653887/chgk/osx/chgk_composer).
- Ubuntu: [chgk_parser](https://dl.dropboxusercontent.com/u/24653887/chgk/ubuntu/chgk_parser), [chgk_composer](https://dl.dropboxusercontent.com/u/24653887/chgk/ubuntu/chgk_composer).

Остальное берите из архива по ссылке выше. Файлы с расширением `.py` можете удалить.

Для экспорта в _Word_ необходим файл `template.docx`, присутствующий в архиве. Для экспорта в _LaTeX_ необходимы `cheader.tex` и `fix-unnumbered-sections.sty`, также присутствующие в архиве, однако вы можете использовать собственную преамбулу, если пожелаете. Подробности экспорта в _LaTeX_ будут изложены в соответствующем разделе документации.

## Как пользоваться ##

Перед использованием положите входные файлы в папку, куда вы распаковали пакет `chgksuite` (или, напротив, скопируйте файлы `chgksuite` в папку, в которой собираетесь работать.

У `chgksuite` есть два режима работы — полностью консольный и консольный с элементами GUI. **Вы можете просто запускать скрипты или бинарные файлы и использовать режим с элементами GUI, следуя инструкциям на экране**. 

Нижеследующая инструкция относится к консольному режиму.

`chgk_parser (filename).(ext)` — парсит входной файл `(filename).(ext)` и создаёт `(filename).4s`. Тип файла (_Word_ или _plain text_) определяется по расширению, поэтому убедитесь, что ваши файлы имеют корректные расширения. Так, `chgk_parser.py paket.docx` создаст файл `paket.4s`.

`chgk_composer (filename).4s (output-filetype) (-l lj-user (-c community)) (--nospoilers|-n)` — создаёт из `.4s`-файла выходной файл указанного типа. Допустимые значение `(output-filetype)` — `docx`, `tex` и `lj`. В первых двух случаях будет создан выходной файл `(filename).docx` и `(filename).tex`, соответственно. При указании `lj` в качестве выходного формата также обязательно указать параметр `-l lj-user`, где `lj-user` — ваш логин в ЖЖ. После этого необходимо ввести пароль от вашего аккаунта в ЖЖ.

Если вы выкладываете пакет не в личный ЖЖ, а в сообщество, после `-l lj-user` введите `-c community`, где `community` — название сообщества (например, `ru_chgk`). Обратите внимание, что **выкладка в личный ЖЖ по умолчанию происходит «под глаз»**, так что итоговый пост виден только вам. Вы сможете посмотреть, всё ли выглядит так, как вы задумали, и после этого через форму редактирования поста на сайте ЖЖ изменить настройки видимости, чтобы его могли увидеть и другие пользователи. При выкладке в сообщество, однако, создатели ЖЖ не предусмотрели возможность выкладки «под глаз», так что **выкладка в сообщество публична**. Поэтому перед тем, как выложить пакет в сообщество, можно выложить пакет в личный ЖЖ под глаз, чтобы удостовериться, что пакет выглядит именно так, как вы задумывали.

Для режимов `docx` и `lj` по умолчанию включен режим «спойлеров», чтобы читатель не видел ответы и комментарии. Добавление `--nospoilers` к строке вызова программы позволяет вывести результат без спойлеров.

Также для всех режимов работает опция `--debug` для вывода отладочной информации. Если у вас что-то не работает или работает не так, как нужно, [создайте тикет](https://bitbucket.org/pecheny/chgksuite/issues?status=new&status=open) и пришлите туда эти файлы.

Примеры:

- `chgk_composer paket.4s docx` — создаст файл `paket.docx` с забелёнными ответами и комментариями.
- `chgk_composer paket.4s docx --nospoilers` — создаст файл `paket.docx` без забелённых ответов.
- `chgk_composer paket.4s tex` — создаст файл `paket.tex`, из которого впоследствии можно создать PDF, если у вас установлен LaTeX. Обратите внимание, что PDF-файлы предназначены для того, чтобы их читал ведущий на игре с распечатки или экрана планшета. Спойлеры в них не предусмотрены.
- `chgk_composer paket.4s lj -l pecheny` — выложит пакет со спойлерами в ЖЖ `pecheny`. Запись будет видна только пользователю `pecheny`.
- `chgk_composer paket.4s lj -l pecheny -c ru_chgk --nospoilers` — выложит пакет без спойлеров в сообщество `ru_chgk` от лица пользователя `pecheny`. Запись будет видна всем.

## Микроформат .4s ##

Микроформат _4s_ (название может поменяться) вдохновлён существующими микроформатами типа _Markdown_ и _reStructuredText_, однако отличается от них в силу специфики структуры пакетов ЧГК. Пакет в формате _4s_ состоит из последовательности элементов, принадлежащих к одному из типов. В начале строки записывается идентификатор типа элемента, а затем через любое количество пробелов — его значение. Строчка без идентификатора типа в начале считается продолжением предыдущего элемента (внутри элемента разрешены одинарные переносы строк). Существуют следующие типы элементов:

- `###`: заголовок.
- `###LJ`: заголовок для поста в ЖЖ, если вы хотите, чтобы он не совпадал с заголовком в теле поста (например, если последний — слишком длинный).
- `#EDITOR`: редактор.
- `#DATE`: дата (отображающаяся в начале документа)
- `#`: любой метакомментарий, например, благодарности тестерам в преамбуле.
- `?`: текст вопроса.
- `№`: номер вопроса, если вы предпочитаете ручную нумерацию автоматической. Его следует использовать для ввода нулевых вопросов. Это поле строковое, так что возможны вопросы с номерами `000`, `3.14`, `14a`, `мой любимый` etc.
- `!`: ответ.
- `=`: зачёт.
- `!=`: незачёт.
- `/`: комментарий.
- `^`: источник(и).
- `@`: автор(ы).

Из них элементы «вопрос» (`?`) и «ответ» (`!`) являются обязательными, прочие — опциональны.

Внутри элементов также возможно следующее дополнительное форматирование:

- ```удар`ение```: ударéние
- `_курсив_`: _курсив_
- `(img w=20px h=40px kotik.jpg)`: вставка локального изображения `kotik.jpg` шириной 20 пикселей и высотой 40 пикселей. Показатели ширины и высоты __опциональны__. Для экспорта в ЖЖ в настоящий момент вместо локального изображения следует вставлять URL-адреса картинок.
- `-`: маркер элемента списка. Списки удобны для оформления нескольких источников, а также дуплетов и блицев.

Таким образом, начало пакета в формате _4s_ может выглядеть так:
```
#!html
### XIII Кубок Ленинского района, организованный А. А. Петровым, милостивым и милосердным, на деньги холдинга «Вектор»
###LJ Кубок Ленинского района
#EDITOR Редактор — С. Каценеленбоген
#DATE 30 февраля 2014

# Редактор благодарит тестеров и свою маму.

? [Раздаточный материал: (img test.jpg)]
Уважаемые знатоки! Что вы видите на этой розданном вам изображении?
№ 0
! гиппопотам.
= бегемот.
/ изображение напоминает бегемота в солнечный день, если его перевернуть.
^ 
- З. Фрейд. Психопатология обыденной жизни
- Г. Роршах. Психодиагностика
@ С. Каценеленбоген
```