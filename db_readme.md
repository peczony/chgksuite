# Как выложить ваш пакет в Базу при помощи chgksuite

## Установка и начало работы

[Скачайте](https://bitbucket.org/pecheny/chgksuite/downloads/) последнюю версию для Windows или macOS и распакуйте в отдельную папку.

Если исходный файл с пакетом сохранён в формате старого Ворда `.doc`, пересохраните его как `.docx`.

Перед тем, как получить текстовый файл в формате Базы, вам нужно сохранить его в промежуточном формате `.4s`.

Запустите chgksuite, нажмите кнопку `Parse file(s)` и выберите ваш docx-файл.

![стартовый диалог chgksuite](https://i.imgur.com/Z8lPrFP.png | width=600)

В той же папке, где и docx-файл, появится файл с расширением `.4s`. Откройте его в текстовом редакторе. Если кажется, что что-то не так с переносами строк, воспользуйтесь не стандартным Блокнотом, а, например, бесплатным [Notepad++](https://notepad-plus-plus.org/).

Правильное начало файла должно выглядеть примерно так:

```
###LJ XIV межрегиональный кубок «Интеллектуальная ворона»

### XIV межрегиональный кубок «Интеллектуальная ворона»

#DATE 2019-05-26

## Тур 1

#EDITOR Редактор — Максим Мерзляко́в (Воронеж).

# _Редактор благодарит за тестирование вопросов и ценные замечания Сергея Донецко́ва, Дмитрия Доро́жко, Александра Кама́ева, Дмитрия Ко́гана, Александра Коробе́йникова, Сергея Кру́пника, Александра Мерзли́кина, Юлию Мещеряко́ву, Дениса Ми́кшиса, Олега Михе́ева, Жанну Подоля́к, Дмитрия Пономарёва, Антона Саксо́нова, Дмитрия Сло́уща, Сергея Тере́нтьева, Наи́ляФару́кшина и Сергея Че́лышева._

? [Раздаточный материал:
Но он не шёл. Луна скрывалась,
Луна сияла сквозь туман,
Бежала мгла... И мне казалось,
Что на снегу сидит Сапсан.
Морозный иней, как алмазы,
Сверкал на нём, а он дремал,
Седой, зобастый, круглоглазый,
И в крылья голову вжимал.
]
Заглавный герой стихотворения Бу́нина, фрагмент которого мы вам раздали, молчалив. Тем не менее, по словам Корне́я Чуко́вского, Бунин вдохновлялся… Каким автором?
! Эдгаром Алланом По.
= по фамилии «По» без неверных уточнений.
/ стихотворение называется «Сапсан». Кроме птичьих названий, с «Вороном» Эдгара По его роднит и мистическая атмосфера. Мы приветствуем вас на «Интеллектуальной вороне»!
^ 
- И. Бунин. Сапсан; https://tinyurl.com/y59b6cak
- И. Петрова. Очарованная душа; https://tinyurl.com/y2un4wxe
@ Максим Мерзляков (Воронеж)
```

## Краткое описание формата .4s

Вот что значит

- `###LJ` Краткое название турнира для постов в ЖЖ. Если вы не собираетесь выкладывать пакет в ЖЖ, а только в базу, оставьте это поле как есть
- `###` Полное название турнира. В формате базы превращается в «Чемпионат:»
- `#DATE` — дата. Необязательно именно в таком формате, может быть, например «26 мая 2019», а вот «Москва, 26 мая 2019» в этом поле писать не стоит — парсер дат такое не поймёт. В формате базы — «Дата:»
- `#EDITOR` — редактор(ы). В формате базы — «Редактор:»
- `#` дополнительная информация о турнире или туре, например, список тестеров. В формате базы — «Инфо:»
- `?`  — текст вопроса. В нём не должно быть двойных переносов строки, могут быть только одинарные.
- `!` — ответ.
- `=` — зачёт.
- `!=` — незачёт.
- `/` — комментарий.
- `^` — источник(и).
- `@` — автор(ы).
- `-` — маркер списков. Списки могут быть в полях «Вопрос», «Ответ» и «Источник». В полях «Вопрос» и «Ответ» при помощи списков оформляются дуплеты и блицы.
- `(img имя_файла_с_картинкой)` — картинка. В формате базы — «`(pic: имя_файла_с_картинкой)`».

Пример дуплета с картинкой:

```
? [Ведущему: раздать командам, как обычно, по три экземпляра раздаточного материала! Один из экземпляров команда должна сдать в качестве ответного бланка!]
[Раздаточный материал: (img 001.png)]
Дуплет: два вопроса по 30 секунд обсуждения на каждый. Напишите название своей команды на одном из экземпляров раздаточного материала и сдайте ответы дуплета на нём вместо ответного бланка. Пожалуйста, впишите ответы по соседству: первый — в первые три клетки, второй — в следующие три.
- Правитель Топи́льцин взял себе имя бога Кетцалькоа́тля, которое переводится как «Пернатый Змей». По легенде, он обучил индейцев письму, поэтому некоторые мистики утверждают, что Кетцалькоатль — это ПРОПУСК. Заполните ПРОПУСК.
- В 1860 году население одного из городов Колорадо составляло десять тысяч человек, а в 1890 — двести двадцать два человека. Название этого города — ПРОПУСК. Заполните ПРОПУСК.
! 
- Тот;
- Оро.
= точные ответы.
/ Кетцалькоатля сопоставляют с ибисоголовым богом Тотом, который тоже был пернат и обучил египтян грамоте. Город Оро, н в переводе с испанского означает «золото», был основан во время золотой лихорадки и заброшен после её окончания. Если соединить ответы дуплета, то получится имя заглавного персонажа аниме Хая́о Миядза́ки «Мой сосед То́торо», так что слова «по соседству» могли послужить подсказкой.
^ 
- https://ru.wikipedia.org/wiki/Кетцалькоатль
- https://ru.wikipedia.org/wiki/Тот
- https://tinyurl.com/y3fa7h7e
- https://en.wikipedia.org/wiki/Oro\_City,\_Colorado
- https://ru.wikipedia.org/wiki/Мой\_сосед\_Тоторо
@ Максим Мерзляков (Воронеж)
```

Вы можете заметить, что в вопросе выше в ссылках на источники символы `_` переданы как `\_`. Это не ошибка, так парсер экранирует символы подчёркивания, потому что в формате 4s с помощью символов подчёркивания изображается курсив. При экспорте в формат базы символы `\` исчезнут.

## Обработка получившегося 4s-файла

Проверьте, что всё распарсилось как надо и подготовьте файл к экспорту в базу. Опыт показал, что самый простой способ сделать это — Ctrl-F по сочетанию символов `# `. Во-первых, все «непонятные» для парсера места парсятся как дополнительная информация, во-вторых, некоторая вполне легитимная дополнительная информация в файле с пакетом при выкладке в базу неуместна и её стоит удалить — например, инструкции ведущему.

Частые проблемы:

1. Начало тура выглядит не как `## Тур N`, а как `# # Тур N` или как `# Тур N`
2. Разделитель `# * * *`, часто встречающийся между турами. Его стоит убрать.
3. Иногда бывают проблемы с парсингом дуплетов и блицев, например:  
![пример некорректного парсинга](https://i.imgur.com/PHhliQH.png | width=800)  
Проставьте идентификаторы соответствующих полей вручную.

## Создание txt-файла и заливка в Базу

Вновь запустите chgksuite. Нажмите кнопку `Compose` и выберите ваш 4s-файл. Появится диалог экспорта.

![диалог экспорта из формата 4s](https://i.imgur.com/wTNITfj.png | width=400)

Не обращайте внимание на галочки — они имеют значение для других типов экспорта — в docx, LaTeX и ЖЖ. Нажмите кнопку `db.chgk.info`. Рядом с 4s-файлом появится txt-файл, содержащий ваш пакет в формате Базы. Откройте его и скопируйте весь текст. Проверьте его [валидатором](http://api.baza-voprosov.ru/validator) и выложите в саму Базу по [инструкции](https://db.chgk.info/add-questions).

Если будут вопросы, пишите мне в [телеграм](https://t.me/pecheny), [вконтакте](https://vk.com/pecheny) или [фейсбук](https://m.me/pecheny) (фейсбук проверяю редко).